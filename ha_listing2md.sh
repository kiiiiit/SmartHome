#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ –ª–∏—Å—Ç–∏–Ω–≥–∞ –≤—Å–µ—Ö YAML-—Ñ–∞–π–ª–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Home Assistant.

# –ò–º—è –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
OUTPUT_FILE="fullConfigListingOfHomeAssistant_$(date +'%Y%m%d_%H%M%S').md"

# –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
CONFIG_DIR="./config"

# –û–ø–æ–≤–µ—â–µ–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ —Ä–∞–±–æ—Ç—ã
echo "üöÄ –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –ª–∏—Å—Ç–∏–Ω–≥–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏..."

# –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π —Ñ–∞–π–ª, –µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è
find . -name "fullConfigListingOfHomeAssistant_*.md" -delete

# –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–ø–∏—Å—å –≤ –Ω–æ–≤—ã–π —Ñ–∞–π–ª
echo "# –ü–æ–ª–Ω—ã–π –ª–∏—Å—Ç–∏–Ω–≥ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Home Assistant" > "$OUTPUT_FILE"
echo "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ: $(date)" >> "$OUTPUT_FILE"
echo "" >> "$OUTPUT_FILE"

# –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ .yaml —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ config, —Å–æ—Ä—Ç–∏—Ä—É–µ–º –∏—Ö –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞,
# –∏ –¥–æ–±–∞–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ –≤ –∏—Ç–æ–≥–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç.
find "$CONFIG_DIR" -name "*.yaml" | sort | while read -r filepath; do
  echo "   -> –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Ñ–∞–π–ª: $filepath"
  echo "" >> "$OUTPUT_FILE"
  echo "---" >> "$OUTPUT_FILE"
  echo "" >> "$OUTPUT_FILE"
  # –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å –ø—É—Ç–µ–º –∫ —Ñ–∞–π–ª—É
  echo "## \`$filepath\`" >> "$OUTPUT_FILE"
  echo "" >> "$OUTPUT_FILE"
  # –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –≤ –±–ª–æ–∫ –∫–æ–¥–∞ YAML
  echo '```yaml' >> "$OUTPUT_FILE"
  cat "$filepath" >> "$OUTPUT_FILE"
  echo "" >> "$OUTPUT_FILE" # –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –≤ –∫–æ–Ω—Ü–µ –¥–ª—è —á–∏—Å—Ç–æ—Ç—ã
  echo '```' >> "$OUTPUT_FILE"
  echo "" >> "$OUTPUT_FILE"
done

echo "‚úÖ –ì–æ—Ç–æ–≤–æ! –õ–∏—Å—Ç–∏–Ω–≥ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω: $OUTPUT_FILE" 