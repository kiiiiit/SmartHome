## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ESP32-C6 –¥–ª—è MQTT - –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

–ò—Å—Ö–æ–¥—è –∏–∑ –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –≤–∞—à **OpenTherm 2.2 ESP32-C6** —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –∏–º–µ–µ—Ç –ø—Ä–æ—à–∏–≤–∫—É **live-control**. –†–∞—Å—Å–º–æ—Ç—Ä—é –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

### **üîç 1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Ç–µ–∫—É—â—É—é –ø—Ä–æ—à–∏–≤–∫—É ESP32-C6**

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**
```bash
# –ù–∞–π–¥–∏—Ç–µ IP –∞–¥—Ä–µ—Å ESP32-C6 –≤ —Ä–æ—É—Ç–µ—Ä–µ –∏–ª–∏ —Å–∫–∞–Ω–µ—Ä–æ–º
nmap -sn 192.168.0.0/24

# –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
http://192.168.0.XXX
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø—Ä–æ—à–∏–≤–æ–∫:**
- **live-control** (–∑–∞–≤–æ–¥—Å–∫–∞—è –æ—Ç Sprut.AI)
- **OTGateway** (–æ—Ç Laxilef) 
- **Custom OpenTherm** (—Å–∞–º–æ–ø–∏—Å–Ω–∞—è)

### **üõ†Ô∏è 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –ø—Ä–æ—à–∏–≤–∫–∏ live-control**

**–ï—Å–ª–∏ —É –≤–∞—Å live-control (–Ω–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω–æ):**

**–í–æ–π–¥–∏—Ç–µ –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ESP32-C6:**
1. **–û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä:** `http://IP_–ê–î–†–ï–°_ESP32`
2. **–ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª:** "MQTT Settings" –∏–ª–∏ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ MQTT"
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**

```yaml
# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã MQTT –≤ live-control:
MQTT Broker: 192.168.0.100    # IP –≤–∞—à–µ–≥–æ Home Assistant
MQTT Port: 1883
MQTT User: homeassistant       # –ò–∑ secrets.yaml
MQTT Password: your_mqtt_password
Client ID: opentherm_esp32c6
Base Topic: opentherm          # –ë–∞–∑–æ–≤—ã–π —Ç–æ–ø–∏–∫
```

**–¢–æ–ø–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥–µ—Ç –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å ESP32-C6:**
```bash
# –°–µ–Ω—Å–æ—Ä—ã (–¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –≤–∞—à–∏–º boiler.yaml):
opentherm/sensors/feed_temperature
opentherm/sensors/return_temperature  
opentherm/sensors/dhw_temperature
opentherm/sensors/outdoor_temperature
opentherm/sensors/pressure
opentherm/sensors/modulation

# Binary —Å–µ–Ω—Å–æ—Ä—ã:
opentherm/binary_sensors/flame_status
opentherm/binary_sensors/ch_enabled
opentherm/binary_sensors/dhw_enabled
opentherm/binary_sensors/fault

# –ö–æ–º–∞–Ω–¥—ã (–ø–æ–¥–ø–∏—Å–∫–∞):
opentherm/thermostat/setpoint/set
opentherm/thermostat/mode/set
```

### **üîß 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è OTGateway (–µ—Å–ª–∏ –ø–µ—Ä–µ–ø—Ä–æ—à–∏–ª–∏)**

**–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ OTGateway –æ—Ç Laxilef:**

**–û—Ç–∫—Ä–æ–π—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å OTGateway:**
```yaml
# –í —Ä–∞–∑–¥–µ–ª–µ MQTT Settings:
MQTT Server: 192.168.0.100
MQTT Port: 1883  
MQTT User: homeassistant
MQTT Password: your_password
Device Name: baxi_boiler
Discovery Prefix: homeassistant
```

**OTGateway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç discovery —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è HA.**

### **üêç 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è custom –ø—Ä–æ—à–∏–≤–∫–∏**

**–ï—Å–ª–∏ —É –≤–∞—Å —Å–∞–º–æ–ø–∏—Å–Ω–∞—è –ø—Ä–æ—à–∏–≤–∫–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥:**

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –∫–æ–¥–µ:**
```cpp
// –ò–∑ –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ - –ø—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫:
const char* mqtt_server = "192.168.0.100";    // IP Home Assistant
const char* mqtt_user = "homeassistant";      
const char* mqtt_password = "your_password";
const int mqtt_port = 1883;

// MQTT —Ç–æ–ø–∏–∫–∏ (–¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å boiler.yaml):
const char* TEMP_BOILER_GET_TOPIC = "opentherm/sensors/feed_temperature";
const char* TEMP_SETPOINT_SET_TOPIC = "opentherm/thermostat/setpoint/set";
const char* MODE_SET_TOPIC = "opentherm/thermostat/mode/set";
```

### **üìã 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–æ–ø–∏–∫–æ–≤**

**–°—Ä–∞–≤–Ω–∏—Ç–µ —Ç–æ–ø–∏–∫–∏ –≤ –≤–∞—à–µ–º boiler.yaml —Å ESP32-C6:**

**–í boiler.yaml —É –≤–∞—Å –µ—Å—Ç—å:**
```yaml
# –°–µ–Ω—Å–æ—Ä—ã:
state_topic: "opentherm/sensors/feed_temperature"
state_topic: "opentherm/sensors/return_temperature"
state_topic: "opentherm/sensors/pressure"
state_topic: "opentherm/sensors/modulation"

# Binary —Å–µ–Ω—Å–æ—Ä—ã:
state_topic: "opentherm/binary_sensors/flame_status"
state_topic: "opentherm/binary_sensors/ch_enabled"
state_topic: "opentherm/binary_sensors/fault"

# –ö–æ–º–∞–Ω–¥—ã:
temperature_command_topic: "opentherm/thermostat/setpoint/set"
mode_command_topic: "opentherm/thermostat/mode/set"
```

**ESP32-C6 –¥–æ–ª–∂–µ–Ω –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –≤ —ç—Ç–∏ –∂–µ —Ç–æ–ø–∏–∫–∏!**

### **üîç 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã MQTT**

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ MQTT Explorer –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:**

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ MQTT –±—Ä–æ–∫–µ—Ä—É HA:
Host: 192.168.0.100
Port: 1883
Username: homeassistant
Password: your_password

# –ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –≤—Å–µ —Ç–æ–ø–∏–∫–∏ OpenTherm:
opentherm/#

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ ESP32-C6 –ø—É–±–ª–∏–∫—É–µ—Ç –¥–∞–Ω–Ω—ã–µ
```

**–ò–ª–∏ —á–µ—Ä–µ–∑ Home Assistant Developer Tools:**
```yaml
# Services > MQTT > Listen to topic
Topic: opentherm/#
```

### **‚öôÔ∏è 7. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–Ω–µ—à–Ω–µ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã (POK005)**

**–î–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –æ—Ç POK005 –≤ ESP32-C6:**

**–ß–µ—Ä–µ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é –≤ HA (–∏–∑ –≤–∞—à–µ–≥–æ boiler.yaml):**
```yaml
automation:
  - alias: "Boiler - Update Outdoor Temperature"
    trigger:
      - platform: state
        entity_id: sensor.pok005_temperature
    action:
      - service: mqtt.publish
        data:
          topic: "opentherm/sensors/outdoor_temperature"
          payload: "{{ states('sensor.pok005_temperature') }}"
```

**–ò–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ ESP32-C6 –Ω–∞ –ø–æ–¥–ø–∏—Å–∫—É:**
```bash
# ESP32-C6 –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞:
zigbee2mqtt/POK005/temperature
# –ò —Ä–µ—Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç –≤:
opentherm/sensors/outdoor_temperature
```

### **üöÄ 8. –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏**

```bash
# 1. –ù–∞–π–¥–∏—Ç–µ IP ESP32-C6
nmap -sn 192.168.0.0/24 | grep -B2 "ESP32\|OpenTherm"

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
curl -I http://IP_ESP32:80

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ MQTT –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ –ª–æ–≥–∞—Ö HA
ha core logs | grep mqtt

# 4. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫—É –∫–æ–º–∞–Ω–¥
# Developer Tools > Services > MQTT Publish
# Topic: opentherm/thermostat/setpoint/set
# Payload: 21
```

### **üìä 9. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º**

**–ï—Å–ª–∏ ESP32-C6 –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ MQTT:**

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**
2. **–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Mosquitto broker –∑–∞–ø—É—â–µ–Ω –≤ HA**
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ ESP32-C6 —á–µ—Ä–µ–∑ Serial Monitor**
4. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π MQTT –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**

**–ï—Å–ª–∏ —Ç–æ–ø–∏–∫–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç:**

1. **–ò–∑–º–µ–Ω–∏—Ç–µ –±–∞–∑–æ–≤—ã–π —Ç–æ–ø–∏–∫ –≤ ESP32-C6**
2. **–ò–ª–∏ –æ–±–Ω–æ–≤–∏—Ç–µ boiler.yaml –ø–æ–¥ —Ç–µ–∫—É—â–∏–µ —Ç–æ–ø–∏–∫–∏**
3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Home Assistant**

### **‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**

–ü–æ—Å–ª–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ Home Assistant –ø–æ—è–≤—è—Ç—Å—è:
- `climate.baxi_boiler` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—Ç–ª–æ–º
- `sensor.boiler_feed_temperature` - —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø–æ–¥–∞—á–∏
- `sensor.boiler_modulation` - –º–æ–¥—É–ª—è—Ü–∏—è
- `binary_sensor.boiler_flame_status` - —Å—Ç–∞—Ç—É—Å –≥–æ—Ä–µ–ª–∫–∏

**–ö–∞–∫—É—é –ø—Ä–æ—à–∏–≤–∫—É –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–∞—à–µ–≥–æ ESP32-C6?** –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –¥–∞—Ç—å –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ.

[1] https://docs.espressif.com/projects/esp-at/en/latest/esp32c6/AT_Command_Examples/MQTT_AT_Examples.html
[2] https://www.instructables.com/Smart-IoT-Sensor-Built-With-XIAO-ESP32C6-WiFi-MQTT/
[3] https://community.home-assistant.io/t/mqtt-opentherm-controller-need-help-adapting-code/314031
[4] https://sprut.ai/catalog/item/termostat-opentherm-2-2-wi-fi-6-zigbee
[5] https://forum.baxi.ru/viewtopic.php?t=9256
[6] https://community.alexgyver.ru/threads/opensource-opentherm-kontroller-termostat-dlja-upravlenija-otopleniem.12660/
[7] https://habr.com/ru/articles/759964/
[8] https://www.ozon.ru/product/termostat-opentherm-2-2-na-chipe-esp-32-c6-wi-fi-zigbee-korpus-na-din-reyku-dlya-podklyucheniya-po-1366519343/reviews/
[9] https://www.youtube.com/watch?v=iZtRADLuE4c
[10] https://www.reddit.com/r/esp32/comments/1g2ms0e/esp32c6_wifi_sensor_for_home_assistant/