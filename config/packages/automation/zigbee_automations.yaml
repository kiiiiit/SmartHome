# –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –¥–ª—è Zigbee —É—Å—Ç—Ä–æ–π—Å—Ç–≤
automation:
  - alias: "Zigbee - Low Battery Alert"
    description: "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–∏–∑–∫–æ–º –∑–∞—Ä—è–¥–µ –±–∞—Ç–∞—Ä–µ–π Zigbee —É—Å—Ç—Ä–æ–π—Å—Ç–≤"
    trigger:
      # –¢—Ä–∏–≥–≥–µ—Ä –ø–æ –≤–∫–ª—é—á–µ–Ω–∏—é –±–∏–Ω–∞—Ä–Ω–æ–≥–æ —Å–µ–Ω—Å–æ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –ª–æ–≥–∏–∫—É
      - platform: state
        entity_id: binary_sensor.low_battery_alert
        to: 'on'
    action:
      - service: script.send_climate_notification
        data:
          title: "üîã –ù–∏–∑–∫–∏–π –∑–∞—Ä—è–¥ Zigbee"
          # –°–æ–æ–±—â–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø–æ-–¥—Ä—É–≥–æ–º—É, —Ç.–∫. —Ç—Ä–∏–≥–≥–µ—Ä –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
          # –ú—ã –º–æ–∂–µ–º –ø–µ—Ä–µ—á–∏—Å–ª–∏—Ç—å –≤—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Å –Ω–∏–∑–∫–∏–º –∑–∞—Ä—è–¥–æ–º
          message: >
            –ù–∏–∑–∫–∏–π –∑–∞—Ä—è–¥ —É —Å–ª–µ–¥—É—é—â–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤:
            {% set threshold = states('input_number.low_battery_threshold') | int(20) %}
            {% for state in states.group.all_battery_sensors.attributes.entity_id %}
              {% set sensor = states[state] %}
              {% if sensor.state | int(100) < threshold %}
                - {{ sensor.name }}: {{ sensor.state }}%
              {% endif %}
            {% endfor %}
            –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–º–µ–Ω–∞ –±–∞—Ç–∞—Ä–µ–π.
          mobile: true

  - alias: "Zigbee - Device Offline Alert"
    description: "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Zigbee —É—Å—Ç—Ä–æ–π—Å—Ç–≤"
    trigger:
      - platform: state
        entity_id:
          - sensor.pok005_temperature
          - sensor.vvo_smart_life_temperature
          - binary_sensor.sonoff_snzb_06p_occupancy
        to: 'unavailable'
        for: "00:30:00"
    action:
      - service: script.send_climate_notification
        data:
          title: "üì° Zigbee —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ"
          message: "{{ trigger.to_state.attributes.friendly_name }} –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –±–æ–ª–µ–µ 30 –º–∏–Ω—É—Ç."
          priority: high # –≠—Ç–æ –∫–∞—Å—Ç–æ–º–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –Ω–∞—à–µ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞, —É–±–µ–¥–∏–º—Å—è —á—Ç–æ –æ–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
          mobile: true

  - alias: "Zigbee - Extreme Temperature Alert POK005"
    description: "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞—Ö POK005"
    trigger:
      - platform: numeric_state
        entity_id: sensor.pok005_temperature
        below: "{{ states('input_number.extreme_cold_threshold') | int }}"
      - platform: numeric_state
        entity_id: sensor.pok005_temperature
        above: 38
    action:
      - service: script.send_climate_notification
        data:
          title: "üå°Ô∏è –≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–∞—è —É–ª–∏—á–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (POK005)"
          message: "–£–ª–∏—á–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: {{ states('sensor.pok005_temperature') }}¬∞C. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏—Å—Ç–µ–º—ã."
          priority: high
          mobile: true 